# Default Configurations for a Quicklook Pipeline setup for a dark science exposure
name: DESI Quicklook Dark,Grey,Bright Survey
Program: dark,gray,bright
Flavor: science
#- Writeout intermediate files
WritePreprocfile: True
#- Debuglevel 
Debuglevel: 20
#- Heartbeat Period in seconds
Period: 5.0
#- Time out in seconds
Timeout: 120.0
# Pipeline algorithm: PAs and QAs for each PA
Pipeline: [Initialize, Preproc, Flexure, Extract_QP, ApplyFiberFlat_QP, SkySub_QP, ApplyFluxCalibration]
Algorithms:
    Initialize:
        PEAKS: {B_PEAKS: [3914.4,5578.9], R_PEAKS: [6301.9,7342.8], Z_PEAKS: [8432.4,9378.5]}
        QA: {} 
    Preproc:
        QA: 
            Bias_From_Overscan:
                PARAMS: {BIAS_AMP_NORMAL_RANGE: [-20.0, 20.0], BIAS_AMP_WARN_RANGE: [-30.0, 30.0], BIAS_AMP_BRIGHT_REF:[118.2,195.8,119.9,105.5],BIAS_AMP_DARK_REF:[132.9,122.8,130.0,140.3],BIAS_AMP_GRAY_REF:[117.1,179.5,179.2,126.5]}
            Get_RMS:
                PARAMS: {PERCENTILES: [68.2,95.4,99.7], NOISE_AMP_NORMAL_RANGE: [-0.5,0.5], NOISE_AMP_WARN_RANGE: [-0.75, 0.75],NOISE_AMP_BRIGHT_REF:[3.03,2.78,2.72,2.69],NOISE_AMP_DARK_REF:[3.22,3.14,3.49,3.22],NOISE_AMP_GRAY_REF:[3.14,3.22,3.22,3.49]}
            Count_Pixels:
                PARAMS: {CUTPIX: 5, LITFRAC_AMP_NORMAL_RANGE: [-0.06, 0.06], LITFRAC_AMP_WARN_RANGE: [-0.09, 0.09],LITFRAC_AMP_BRIGHT_REF:[0.41,0.43,0.41,0.42],LITFRAC_AMP_DARK_REF:[0.35,0.36,0.32,0.33],LITFRAC_AMP_GRAY_REF:[0.36,0.36,0.32,0.33]}
            Calc_XWSigma:
                PARAMS: {PIXEL_RANGE: 7,
                         MAX_SIGMA: 10,
                         XWSIGMA_NORMAL_RANGE: [-0.4, 0.4],XWSIGMA_WARN_RANGE: [-0.6, 0.6],
                         XWSIGMA_BRIGHT_REF:[1.11,2.17],XWSIGMA_DARK_REF:[1.12,1.83],XWSIGMA_GRAY_REF:[1.12,1.83]}
    Flexure:
        QA:
            Trace_Shifts:
                PARAMS: {XYSHIFTS_NORMAL_RANGE: [-0.02,0.02], XYSHIFTS_WARN_RANGE: [-0.03,0.03],XYSHIFTS_BRIGHT_REF:[0.00760,-0.00910],XYSHIFTS_DARK_REF:[0.00743,-0.0106],XYSHIFTS_GRAY_REF:[0.00831,-0.0105]}
    Extract_QP:
        wavelength: {
            b: [3570,5730,0.8],
            r: [5630,7740,0.8],
            z: [7650,9830,0.8]
            }
        QuickResolution: True
        QA: 
            CountSpectralBins:
                PARAMS: {CUTBINS: 5, N_KNOWN_BROKEN_FIBERS: 0, NGOODFIB_NORMAL_RANGE: [-1., 1.], NGOODFIB_WARN_RANGE: [-2., 2.],NGOODFIB_BRIGHT_REF:[500],NGOODFIB_DARK_REF:[500],NGOODFIB_GRAY_REF:[500]}
    ApplyFiberFlat_QP:
        QA:
            Sky_Continuum:
                PARAMS: {B_CONT: ["4000, 4500", "5250, 5550"],
                         R_CONT: ["5950, 6200", "6990, 7230"],
                         Z_CONT: ["8120, 8270", "9110, 9280"],
                         SKYCONT_NORMAL_RANGE: [-20.0, 20.0],SKYCONT_WARN_RANGE: [-30.0, 30.0],
                         SKYCONT_BRIGHT_REF:[190.9],SKYCONT_DARK_REF:[220.8],SKYCONT_GRAY_REF:[230.5]}
            Sky_Peaks:
                PARAMS: {PEAKCOUNT_NORMAL_RANGE: [-1.0, 1.0],PEAKCOUNT_WARN_RANGE: [-2.0, 2.0],
                         PEAKCOUNT_BRIGHT_REF:[74.1],PEAKCOUNT_DARK_REF:[72.5],PEAKCOUNT_GRAY_REF:[72.7]}
    SkySub_QP:
        QA:
            Calculate_SNR:
                #- First two entries set boundaries for SNR residual values via absolute vales or sigmas
                PARAMS: {RESIDUAL_CUT: 0.2, SIGMA_CUT: 2.0, FIDSNR_TGT_NORMAL_RANGE: [-0.2, 0.2], FIDSNR_TGT_WARN_RANGE: [-0.3, 0.3], FIDSNR_TGT_BRIGHT_REF:[0.0,0.223,0.239], FIDSNR_TGT_DARK_REF:[0.537,0.375,0.698,0.592], FIDSNR_TGT_GRAY_REF:[0.540,0.592], FIDMAG: 22.}
    ApplyFluxCalibration:
        QA:
            Sky_Rband:
                PARAMS: {B_CONT: ["4000, 4500", "5250, 5550"],
                         R_CONT: ["5950, 6200", "6990, 7230"],
                         Z_CONT: ["8120, 8270", "9110, 9280"],
                         SKYRBAND_NORMAL_RANGE: [-1.0, 1.0],
                         SKYRBAND_WARN_RANGE: [-2.0, 2.0], SKYRBAND_BRIGHT_REF:[100.], SKYRBAND_DARK_REF:[100.], SKYRBAND_GRAY_REF:[100.]}
            Integrate_Spec:
                PARAMS: {DELTAMAG_TGT_NORMAL_RANGE: [-0.1, 0.1], DELTAMAG_TGT_WARN_RANGE: [-0.2, 0.2],DELTAMAG_TGT_BRIGHT_REF:[0.869,-0.933,-0.906],DELTAMAG_TGT_DARK_REF:[0.497,1.08,0.242,0.394],DELTAMAG_TGT_GRAY_REF:[0.436,0.400]}
